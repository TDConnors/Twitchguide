@{
    ViewBag.Title = "Home";
}

<a href="#" class="click">click here for avatar</a>
<a href="#" class="click2">click here</a>
<br />
<div id="userstats"></div>

@section Scripts {
<script>
    $('.click').click(function () {
        $.ajax({
            url: 'https://api.twitch.tv/kraken/streams/?game=Overwatch',
            type: 'GET',
            dataType: 'json',
            success: function (result) {
                $("#userstats").html(result);
            },
            beforeSend: setHeader
        });
        return false;
    });

    function setHeader(xhr) {
        xhr.setRequestHeader('Client-ID', 'kx6k6d64t0ok27s5sfyo1w5n1q3dn6');
    };

    $('.click2').click(function () {
        $.ajax({
            url: 'https://api.twitch.tv/kraken/user?',
            type: 'GET',
            dataType: 'json',
            success: function (result) {
                $("#userstats").html(result);
            },
            beforeSend: setHeader2
        });
        return false;
    });

    function setHeader2(xhr) {
        var token = "@ViewBag.token";
        //token = token.toString();
        //token = token.split("urn:twitch:access_token: ").pop();
        xhr.setRequestHeader('Client-ID', 'kx6k6d64t0ok27s5sfyo1w5n1q3dn6');
        xhr.setRequestHeader('Authorization', "OAuth " + token);
    };
</script>
}

